# 💗 코드 네임 : 환승 시민 🚆 💗

" 둘이 어떻게 만났어? "

### " 우린 1호선에서 만났어. "

<img alt="킹받는꼬맹이1" style="display: block; margin:0 auto; width:300px" src="https://res.cloudinary.com/dtkt6x68f/image/upload/v1668988410/github/60dcb93b1c5f46364f60f488b70aff9e_res_pwjpia.jpg"> <br>
<img alt="킹받는꼬맹이2" style="display: block; margin:0 auto; width:200px" src="https://res.cloudinary.com/dtkt6x68f/image/upload/v1668989263/github/3f394bc730abad7b4a07afa44112a444_res_agshcz.jpg">

## 환승 시민 프로젝트 구성원

백엔드 팀 `BE`  
|팀내 포지션| 한 줄 소개 | 이름 | 깃허브 | 블로그 |
|--------|----------|-------|------|-------|
|리더| 레드 어몽이 |안태환|https://github.com/nowhereim|
|팀원| 마약 옥수수 |성용환|https://github.com/tlptop|
|팀원| 잇몸 알파카 |오윤지|https://github.com/doodlerrr|

프론트엔드 팀 `FE`
|팀내 포지션| 한 줄 소개 | 이름 | 깃허브 | 블로그 |
|--------|----------|-------|------|-------|
|부리더| |김재우 |https://github.com/wyswhsl21|||
|팀원 | |남해리|https://github.com/NSunR|||
|팀원 | |이상현|https://github.com/shlee1027|||

## API 명세서

아래는 API 명세서 입니다.
| \_ | Method | URI | REQUEST | RESPONSE | 추가 설명 |
|--------|---------|----------|-----------|------------|---------|
|가입 초기 필수 입력 정보 받기|POST|/user| { representProfile: 이미지파일, nickname: "yuyu", phone: "01022760716", gender: false} |{ msg: "가입 되었습니다" }|대표 프로필 및 유저정보 초기값 업로드, `인증 토큰 필수`|
|SMS인증문자발송|POST|/auth/phone|{phone:"01022760716"}|{ msg: "인증 메시지를 전송했습니다"}|인증번호 유효시간 2분|
|SMS인증번호비교(검증)|POST|/auth/compare| { phone:"01022760716", auth : "ak2435" }|{ status: 200, statusMassage: "ok, 전송되었습니다."}|-|
|마이 프로필 업데이트| POST | /profile | { representProfile: 이미지파일, profileImage: [이미지파일], nickname: "jiji", statusmessage: "멋쟁이 4조" } | { status: 200, msg: "유저 프로필 정보가 수정되었습니다"}| `인증 토큰 필수` |
|마이 프로필 조회 | GET | /profile | - | { msg: "유저 프로필이 조회되었습니다", body: userProfileInfo } | `인증 토큰 필수` |

## 추가해야하는 내용

**❎ 문자 인증 서비스 서버 병목현상 해결**
|||
| --------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 문제 상황 | 현재 사용하고 있는 setTimeOut 함수를 이용한 디비 관리는 좋은 처리 방식이 아니다. 이유는 크게 두가지로 추릴 수 있다. <br>(이유1) 인증번호 발급 후 배포가 이루어지는 상황에 대한 고려가 이루어지지 않음<br>(이유2) 서버에 큰 부하를 줄 수 있는 처리 방식임<br><br>첫번째, 인증번호 발급 후 배포가 이루어져야하는 상황이라고 가정해보자. 서버가 내려가면 작업 대기 중이던 함수가 모두 종료된다. 이렇게 되면 setTimeOut함수가 실행되지 않은 상태에서 종료되고 인증번호가 디비에 남아있어 인증번호 만료 시간인 3분이 지나더라도 인증이 가능한 상황이 벌어진다. 이것은 인증시간을 3분 제한의 의미를 상실하게 만들뿐더러 인증 토큰을 탈취 후 공격을 가능함으로 보안상으로도 매우 좋지않다. <br>두번째, 동시간대에 가입하려는 사람들이 몰려 서버부하가 발생한 상황이라 가정해보자. 사람들이 인증서비스를 사용하면 setTimeOut 함수 스택이 계속해서 쌓일 것이고 물려있게 될 것이다. 이렇게 되면 처리시간도 느려져 서버에 치명적이다 |
| 해결 방안 | (해결방안1) settimeOut 함수를 통한 인증 만료 처리 <br> 기존의 settimeOut 함수를 통한 인증 만료 처리 방식 그대로 가져가는 대신 엄격한 에러처리를 통해 미결 건 남지않게 신경 쓰는 방법<br>(해결방안2) DB 스케줄러를 통한 인증 만료처리<br>디비에 인증번호를 저장할 때 생성시간도 기록해 그것을 바탕으로 만료시간 결정 하는 방법<br>이 경우 지속적인 이벤트 감시 그리고 이에 따른 로그 발생시켜 작동에 이상 없는지 서버측에서 쉽게 확인할 수 있게 할 것 |
| 결정 | 2번 방안을 선택해 코드에 적용 <br>(변경 전) setTimeOut 함수를 활용한 인증 만료 처리 <br> (변경 후) DB 스케줄러를 통한 인증 만료 처리 및 지속적인 데이터 변경 감시 추가 |
| 설계 | - 디비 스케줄러를 통한 인증 만료 처리 <br>- 디비에 인증번호 저장할 때 생성 시간을 기록<br>- 생성 시간을 기준으로 오래된 데이터 삭제<br>- 실시간 이벤트 감시 및 로그 생성으로 중앙 서버에서 효율적 관리 도모 |

**❎ 클라우드 스토리지 이미지 파일 업로드 및 로드 성능 개선**
|||
| --- | --- |
| 문제 상황 | 최초 가입시 클라우드 스토리지에 1장만 업로드 되는 대표 프로필의 업로드 성능은 문제가 없다. ( 평균 약 100ms ) 하지만 프로필 변경 시 최대 5장 까지 설정하도록 되어있는 프로필 사진의 평균 이미지 업로드 성능은 최악이다.( 프로필을 최대로 설정한다는 가정 하게 평균 약 14s ) 이는 사용성과 직결되는 문제이기 때문에 반드시 개선이 필요하다. |
| 해결 방안 | 해결방안. 이미지 업로드 부분 코드 리팩토링 및 이미지 리사이징 적용<br>이미지 업로드 전반적인 코드 리팩토링 및 이미지 리사이징 적용을 통한 성능 개선 |
| 결정 및 설계 | - 전반적인 코드 리팩토링 과정 진행 (이미지 업로드 로직의 간략화)<br>- 이미지 리사이징을 적용<br>- 읽기 및 쓰기 성능 최적화 |
